<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Telegram Login</title>

  <style>
    body {
      font-family: Arial;
      background: #0f172a;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .card {
      background: #020617;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
    }
    img {
      border-radius: 50%;
      margin-top: 15px;
    }
  </style>

  <!-- ✅ DEFINE FUNCTION FIRST -->
  <script>
    window.onTelegramAuth = function (user) {
      console.log("TELEGRAM USER:", user);

      fetch("https://teligramloginbackend.onrender.com/api/auth/telegram", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(user)
      })
        .then(res => res.json())
        .then(data => {
          if (data.token) {
            localStorage.setItem("token", data.token);
            document.getElementById("user").innerHTML = `
              <p>Welcome, ${data.user.name}</p>
              <img src="${data.user.photo}" width="80" />
            `;
          } else {
            alert("Login failed");
          }
        })
        .catch(err => {
          console.error("AUTH ERROR:", err);
        });
    };
  </script>
</head>

<body>
  <div class="card">
    <h2>Login with Telegram</h2>

    <!-- ✅ NOW LOAD WIDGET -->
    <script src="https://telegram.org/js/telegram-widget.js?22"
      data-telegram-login="ghantekabot"
      data-size="large"
      data-userpic="true"
      data-radius="10"
      data-onauth="onTelegramAuth">
    </script>

    <div id="user"></div>
  </div>
</body>
</html>
